# コスト試算書

## 月額コスト目標: 1,000円以内

---

## 1. AI分析コスト（Vertex AI - Gemini 1.5 Flash）

### 想定使用量

| 項目 | 数値 |
|------|------|
| ニュース収集頻度 | 2回/日 |
| 1回あたりの記事数 | 平均1件 |
| 月間記事数 | 60件 (2回/日 × 30日) |
| 1記事あたりの入力トークン | 1,500トークン |
| 1記事あたりの出力トークン | 500トークン |

### 料金計算

**Gemini 1.5 Flash 料金**:
- 入力: $0.0375 / 1M トークン
- 出力: $0.15 / 1M トークン

**月間コスト**:
```
入力: 60記事 × 1,500トークン × $0.0375/1M = $0.00338
出力: 60記事 × 500トークン × $0.15/1M = $0.0045
合計: $0.00788 ≈ 約1.2円 (1ドル=150円換算)
```

**年間コスト**: 約14円

---

## 2. Firestore コスト

### 想定使用量

| 項目 | 数値 |
|------|------|
| ニュース保存数 | 60件/月 |
| 取引履歴保存数 | 10件/月 (想定) |
| ポジション更新頻度 | 100回/月 (想定) |
| ダッシュボード読み取り | 60回/月 (1日2回) |

### 料金計算

**Firestore 料金** (asia-northeast1):
- ドキュメント書き込み: $0.18 / 100,000回
- ドキュメント読み取り: $0.06 / 100,000回
- ストレージ: $0.18 / GB

**月間コスト**:
```
書き込み: (60 + 10 + 100) × $0.18/100,000 = $0.000306
読み取り: 60 × $0.06/100,000 = $0.000036
ストレージ: 0.01GB × $0.18 = $0.0018
合計: $0.00214 ≈ 約0.3円
```

### データ削除による節約

3ヶ月以上前のデータを削除することで、ストレージコストを最小化:
- 最大保持データ: 約180件 (60件/月 × 3ヶ月)
- ストレージサイズ: 約0.03GB以下

**年間コスト**: 約4円

---

## 3. BigQuery コスト

### 想定使用量

| 項目 | 数値 |
|------|------|
| 毎日のエクスポート | 2件/日 (ニュース) |
| 月間データ量 | 約5MB |
| クエリ実行頻度 | 10回/月 (分析用) |
| スキャンデータ量 | 100MB/月 |

### 料金計算

**BigQuery 料金**:
- ストレージ: $0.02 / GB (アクティブ)
- クエリ: $5 / TB

**月間コスト**:
```
ストレージ: 0.005GB × $0.02 = $0.0001
クエリ: 0.0001TB × $5 = $0.0005
合計: $0.0006 ≈ 約0.1円
```

### 長期ストレージ活用

90日以上アクセスがないデータは自動的に長期ストレージに移行:
- 長期ストレージ料金: $0.01 / GB (通常の半額)

**年間コスト**: 約1円

---

## 4. Cloud Run コスト (Webダッシュボード)

### 想定使用量

| 項目 | 数値 |
|------|------|
| アクセス頻度 | 1日2回 |
| 月間リクエスト数 | 60回 |
| CPU使用時間 | 10秒/リクエスト |
| メモリ | 512MB |

### 料金計算

**Cloud Run 料金** (asia-northeast1):
- CPU: $0.00002400 / vCPU秒
- メモリ: $0.00000250 / GiB秒
- リクエスト: $0.40 / 100万リクエスト

**月間コスト**:
```
CPU: 60リクエスト × 10秒 × 1vCPU × $0.000024 = $0.0144
メモリ: 60リクエスト × 10秒 × 0.5GiB × $0.0000025 = $0.00075
リクエスト: 60 × $0.40/1,000,000 = $0.000024
合計: $0.01518 ≈ 約2円
```

### 無料枠

Cloud Runは無料枠あり:
- CPU: 180,000 vCPU秒/月
- メモリ: 360,000 GiB秒/月
- リクエスト: 200万リクエスト/月

→ **本システムは無料枠内に収まるため、実質0円**

**年間コスト**: 約0円 (無料枠内)

---

## 5. Cloud Functions コスト (定期実行)

### 想定使用量

| 項目 | 数値 |
|------|------|
| ニュース収集関数実行 | 2回/日 × 30日 = 60回/月 |
| 1回あたりの実行時間 | 30秒 |
| メモリ | 256MB |

### 料金計算

**Cloud Functions 料金**:
- 呼び出し: $0.40 / 100万回
- CPU: $0.0000100 / GHz秒
- メモリ: $0.0000025 / GB秒

**月間コスト**:
```
呼び出し: 60 × $0.40/1,000,000 = $0.000024
CPU: 60 × 30秒 × 0.4GHz × $0.00001 = $0.0072
メモリ: 60 × 30秒 × 0.256GB × $0.0000025 = $0.001152
合計: $0.008376 ≈ 約1.3円
```

### 無料枠

Cloud Functionsも無料枠あり:
- 呼び出し: 200万回/月
- CPU: 400,000 GHz秒/月
- メモリ: 200,000 GB秒/月

→ **本システムは無料枠内に収まるため、実質0円**

**年間コスト**: 約0円 (無料枠内)

---

## 6. Cloud Scheduler コスト

### 想定使用量

| 項目 | 数値 |
|------|------|
| ジョブ数 | 2個 (ニュース収集、データ削除) |
| 実行頻度 | 1日2回 + 月1回 |

### 料金計算

**Cloud Scheduler 料金**:
- $0.10 / ジョブ / 月 (3ジョブまで無料)

**月間コスト**: 無料枠内のため0円

**年間コスト**: 約0円

---

## 7. その他のGCPコスト

### ネットワーク

- Firestore, BigQuery, Cloud Run間の通信: GCP内通信のため無料
- インターネットへの出力: 1GB/月未満のため無料枠内

### ログとモニタリング

- Cloud Logging: 50GB/月まで無料
- Cloud Monitoring: 基本的なメトリクスは無料

**月間コスト**: 約0円

**年間コスト**: 約0円

---

## 8. 外部API コスト

### GMOコイン API

- **料金**: 無料 (取引手数料は別途発生)

### X (Twitter) API

- **Basic プラン**: $100/月 (月100ツイートまで)
- **Free プラン**: 廃止済み

**対応策**:
- Phase 1では手動投稿 (コスト0円)
- Phase 2以降で自動投稿を検討

**月間コスト**: 0円 (手動投稿のため)

---

## 合計コスト

| サービス | 月額コスト | 年額コスト |
|---------|----------|----------|
| Vertex AI (Gemini 1.5 Flash) | 約1.2円 | 約14円 |
| Firestore | 約0.3円 | 約4円 |
| BigQuery | 約0.1円 | 約1円 |
| Cloud Run | 0円 (無料枠) | 0円 |
| Cloud Functions | 0円 (無料枠) | 0円 |
| Cloud Scheduler | 0円 (無料枠) | 0円 |
| その他GCPサービス | 0円 | 0円 |
| GMOコイン API | 0円 | 0円 |
| X API | 0円 (手動投稿) | 0円 |
| **合計** | **約2円** | **約20円** |

---

## コスト増加リスクと対策

### リスク1: ニュース収集頻度の増加

**想定**: 1日2回 → 1日6回に増加

**影響**:
- Vertex AI: 約1.2円 → 約3.6円 (+2.4円)
- Cloud Functions: 無料枠内 → 無料枠内 (影響なし)

**対策**: 1日4回まで無料枠内で収まる

---

### リスク2: 取引頻度の増加

**想定**: 月10回 → 月100回に増加

**影響**:
- Firestore書き込み: 約0.3円 → 約1円 (+0.7円)

**対策**: 取引頻度が高くてもコストインパクトは小さい

---

### リスク3: X API自動投稿の開始

**想定**: Basic プラン契約 ($100/月)

**影響**: 月額2円 → 約15,000円

**対策**:
- 投稿頻度を週1回に制限 (月4回まで)
- 手動投稿を継続
- X API Freeプランの復活を待つ

---

### リスク4: ダッシュボードアクセス頻度の増加

**想定**: 1日2回 → 1日10回に増加

**影響**:
- Cloud Run: 無料枠内 → 無料枠内 (影響なし)
- Firestore読み取り: 約0.3円 → 約1円 (+0.7円)

**対策**: 1日50回アクセスしても無料枠内

---

## OpenAI API との比較

### GPT-4o-mini を使用した場合

| 項目 | Vertex AI | OpenAI API | 差額 |
|------|-----------|-----------|------|
| AI分析コスト | 約1.2円/月 | 約4円/月 | +2.8円/月 |
| 認証管理 | GCP IAM (無料) | API Key管理 | 0円 |
| エコシステム | GCP統合 | 外部サービス | - |
| **月額合計** | **約2円** | **約5円** | **+3円** |

**年間差額**: 約36円 (約75%削減)

---

## 結論

### 月額コスト: 約2円

目標の月額1,000円以内を大幅に下回る**約2円**で運用可能です。

### コスト配分

```
Vertex AI (Gemini): 60% (約1.2円)
Firestore:         15% (約0.3円)
BigQuery:          5%  (約0.1円)
その他:            20% (約0.4円)
```

### 年間コスト: 約20円

40年運用想定でも**約800円**と非常に低コストで運用できます。

### 余裕度

月額予算1,000円に対して、実際のコストは約2円のため、**99.8%の余裕**があります。

この余裕を活用して:
- ニュース収集頻度を増やす
- より高度な分析機能を追加
- バックテスト実行回数を増やす

など、機能拡張が可能です。

---

## 次のアクション

1. ✅ Vertex AI APIを有効化
2. ✅ Cloud Billing Alertを設定 (月額100円でアラート)
3. ✅ コスト監視ダッシュボードを作成
4. ⏳ Phase 1で実際のコストを測定
5. ⏳ Phase 2でコスト最適化を実施

---

**ドキュメントバージョン**: v1.0
**作成日**: 2025-12-28
**次回更新**: Phase 1完了時 (実測値を反映)
