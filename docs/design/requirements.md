# FX自動売買ツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
ニュース分析とテクニカル指標を組み合わせたFX自動売買システムの構築

### 1.2 ゴール
- 年率リターン目標：プラス収支（40年運用想定）
- 最大ドローダウン：10%以内
- 月間コスト：1,000円以内

## 2. 機能要件

### 2.1 ニュース収集・分析機能

#### 2.1.1 ニュース収集
- **情報源**: Gemini Grounding with Google Search（リアルタイム検索）
- **収集頻度**: 2回/日
- **対象言語**: 日本語・英語
- **保存先**: Firestore（最新）、BigQuery（履歴）

#### 2.1.2 AI分析（Vertex AI - Gemini 3 Flash）
- **センチメント分析**: 5段階評価
  - Very Negative (-2)
  - Negative (-1)
  - Neutral (0)
  - Positive (+1)
  - Very Positive (+2)
- **通貨ペア影響度**: USD/JPY、EUR/USDへの影響スコア
- **時間軸判定**:
  - 即時（1時間以内）
  - 短期（1日以内）
  - 中期（1週間以内）
  - 長期（1ヶ月以上）
- **採用理由**: GCP統合、Grounding機能による最新ニュース取得

### 2.2 自動売買機能

#### 2.2.1 取引環境
- **取引業者**: GMOコイン（WebSocket API + REST API）
- **対象通貨ペア**: USD/JPY、EUR/USD
- **口座資金**: 500,000円想定

#### 2.2.2 投資判断ロジック
- **判断要素**:
  1. AIニュース分析結果
  2. テクニカル指標（移動平均、RSI、MACD等）
  3. 過去の取引実績（将来実装）
- **売買条件**: config.jsonで定義

#### 2.2.3 リスク管理
- **1取引最大損失**: 1,000円
- **ポジションサイジング**: 口座残高の0.2%
- **ストップロス**: 20pips（調整可能）
- **トレーリングストップ**: 有効

### 2.3 データ管理機能

#### 2.3.1 Firestore
- 現在のポジション情報
- 最新ニュース（直近100件）
- リアルタイム価格データ
- アクティブな取引情報

#### 2.3.2 BigQuery
- 全取引履歴
- ニュースアーカイブ
- パフォーマンス分析データ
- バックテスト結果

### 2.4 レポート・通知機能

#### 2.4.1 X（Twitter）連携
- **投稿内容**: ニュース要約のみ（投資助言を含まない）
- **投稿頻度**: 2回/日（ニュース収集時）
- **プライバシー**: 公開設定
- **免責事項**: 必須記載

#### 2.4.2 Webダッシュボード
- **表示項目**:
  - 累計損益
  - 勝率
  - 最大ドローダウン
  - 現在のポジション
  - 最新ニュース一覧
  - AIの判断根拠
  - BigQuery分析結果
- **更新頻度**: 1日1回

### 2.5 バックテスト機能
- **フレームワーク**: Backtrader
- **データソース**: GMOコイン履歴データ or CSV
- **検証期間**: 過去5年以上
- **評価指標**: シャープレシオ、最大ドローダウン、勝率

## 3. 非機能要件

### 3.1 パフォーマンス
- ニュース分析処理: 1件あたり5秒以内
- 売買判断: 100ミリ秒以内
- ダッシュボード表示: 3秒以内

### 3.2 可用性
- システム稼働率: 99%以上（月間）
- 取引時間中の停止: 最大5分/日

### 3.3 セキュリティ
- APIキー: 環境変数で管理
- 通信: HTTPS必須
- 認証: Webダッシュボードは認証必須

### 3.4 コスト制約
- Vertex AI (Gemini 3 Flash + Grounding): 月額約37円
- GCP利用料: Firestore + BigQuery + Cloud Run 合計1,000円以内
- 取引コスト: スプレッド考慮

## 4. 技術仕様

### 4.1 技術スタック
- **バックエンド**: Python 3.10+
  - FastAPI（API Server）
  - Backtrader（バックテスト）
  - pandas、numpy（データ処理）
- **フロントエンド**: React + TypeScript
  - Material-UI or Ant Design
  - Recharts（グラフ表示）
- **インフラ**: Google Cloud Platform
  - Cloud Functions（定期実行）
  - Firestore
  - BigQuery
  - Cloud Run（Webアプリ）

### 4.2 外部API / GCPサービス
- GMOコイン FX API (WebSocket + REST)
- Vertex AI (Gemini 3 Flash)
  - Grounding with Google Search機能
- X API v2

## 5. 開発フェーズ

### Phase 1: MVP（1ヶ月目）
- [ ] GMOコイン デモ口座接続
- [ ] 基本的なニュース収集
- [ ] シンプルな売買ロジック
- [ ] ローカル環境での動作確認

### Phase 2: 基本機能（2-3ヶ月目）
- [ ] Firestore/BigQuery連携
- [ ] Webダッシュボード（基本機能）
- [ ] バックテスト環境構築
- [ ] リスク管理機能実装

### Phase 3: 拡張機能（4ヶ月目以降）
- [ ] X自動投稿
- [ ] 高度な分析機能
- [ ] 機械学習による最適化
- [ ] 複数通貨ペア対応

## 6. 制約事項・リスク

### 6.1 法的制約
- 金融商品取引法への準拠
- 投資助言業に該当しない運用
- 免責事項の明記

### 6.2 技術的リスク
- API制限（レート制限）
- ネットワーク遅延
- 予期しない市場変動

### 6.3 運用上の注意
- デモ環境での十分なテスト
- 段階的な資金投入
- 定期的なシステム監視

## 7. 成功指標

### 7.1 定量的指標
- 月間プラス収支達成率: 60%以上
- 最大ドローダウン: 10%以内
- システム稼働率: 99%以上

### 7.2 定性的指標
- コードの保守性
- システムの拡張性
- ユーザビリティ

## 8. 用語集

| 用語 | 説明 |
|------|------|
| ドローダウン | 資産の最大値からの下落率 |
| pips | 為替レートの最小変動単位 |
| スプレッド | 売値と買値の差 |
| センチメント | 市場心理・感情 |
| バックテスト | 過去データでの戦略検証 |

## 9. 更新履歴

| 日付 | バージョン | 更新内容 |
|------|-----------|----------|
| 2025-12-13 | 1.0.0 | 初版作成 |
| 2025-12-28 | 1.1.0 | 取引業者をOANDAからGMOコインに変更 |
| 2025-12-28 | 1.2.0 | AI基盤をOpenAI APIからVertex AIに変更 |
| 2026-01-03 | 1.3.0 | Gemini 3 Flash採用、Grounding機能追加、段階的移行計画追加 |